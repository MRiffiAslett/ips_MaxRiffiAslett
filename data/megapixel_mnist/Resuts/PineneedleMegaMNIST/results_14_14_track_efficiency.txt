Used config:
{'B': 16,
 'B_seq': 16,
 'D': 128,
 'D_inner': 512,
 'D_k': 16,
 'D_v': 16,
 'H': 8,
 'I': 100,
 'M': 100,
 'N': 900,
 'attn_dropout': 0.1,
 'data_dir': 'data/megapixel_mnist/dsets/megapixel_mnist_1500',
 'dropout': 0.1,
 'eager': True,
 'enc_type': 'resnet18',
 'eps': 1e-06,
 'is_image': True,
 'lr': 0.001,
 'n_chan_in': 1,
 'n_class': 10,
 'n_epoch': 150,
 'n_epoch_warmup': 10,
 'n_res_blocks': 2,
 'n_token': 4,
 'n_worker': 8,
 'patch_size': [50, 50],
 'patch_stride': [50, 50],
 'pin_memory': True,
 'pretrained': False,
 'seed': 0,
 'shuffle': True,
 'shuffle_style': 'batch',
 'tasks': {'task0': {'act_fn': 'softmax',
                     'id': 0,
                     'metric': 'accuracy',
                     'name': 'majority'},
           'task1': {'act_fn': 'softmax',
                     'id': 1,
                     'metric': 'accuracy',
                     'name': 'max'},
           'task2': {'act_fn': 'softmax',
                     'id': 2,
                     'metric': 'accuracy',
                     'name': 'top'},
           'task3': {'act_fn': 'sigmoid',
                     'id': 3,
                     'metric': 'multilabel_accuracy',
                     'name': 'multi'}},
 'track_efficiency': True,
 'track_epoch': 0,
 'use_pos': True,
 'wd': 0.1}
/usr/local/lib/python3.10/dist-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at ../aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
/usr/local/lib/python3.10/dist-packages/torch/autograd/graph.py:744: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at ../aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
time:  494.8756408691406
time:  373.5459899902344
time:  374.5157165527344
time:  375.4721374511719
time:  374.6621398925781
time:  373.7763977050781
time:  374.83416748046875
time:  374.57818603515625
time:  375.5263977050781
time:  374.908935546875
time:  373.7733154296875
time:  374.9529724121094
time:  374.7911682128906
time:  375.046142578125
time:  375.67486572265625
time:  374.30987548828125
time:  374.8177795410156
time:  374.5331115722656
time:  375.48748779296875
time:  375.1403503417969
time:  374.7030944824219
time:  375.05023193359375
time:  374.72869873046875
time:  375.6124267578125
time:  375.7619323730469
time:  375.2489013671875
time:  375.9022216796875
time:  375.7803649902344
time:  376.5186462402344
time:  375.2785949707031
time:  375.7015075683594
time:  376.48895263671875
time:  375.31854248046875
time:  374.9191589355469
time:  376.67327880859375
time:  375.9533996582031
time:  375.31854248046875
time:  375.9913024902344
time:  376.22271728515625
time:  375.2591247558594
time:  376.43060302734375
time:  376.6343688964844
time:  376.06298828125
time:  375.8888854980469
time:  376.94976806640625
time:  375.8817138671875
time:  375.9626159667969
time:  376.9599914550781
time:  376.02508544921875
time:  375.9851379394531
time:  377.60101318359375
time:  376.1049499511719
time:  376.1971130371094
time:  377.4064636230469
time:  376.4930419921875
time:  376.4643859863281
time:  377.7392578125
time:  375.77728271484375
time:  377.7279968261719
time:  377.0890197753906
time:  378.8451843261719
time:  378.15399169921875
time:  376.6077575683594
time:  377.68804931640625
time:  377.37677001953125
time:  376.853515625
time:  378.0270080566406
time:  377.33990478515625
time:  378.5195617675781
time:  377.16583251953125
time:  376.84429931640625
time:  378.166259765625
time:  377.3603820800781
time:  378.2799377441406
time:  377.36651611328125
time:  378.71002197265625
time:  377.96453857421875
time:  378.0208740234375
time:  378.0362243652344
time:  378.2686767578125
time:  378.2195129394531
time:  377.8447265625
time:  377.62969970703125
time:  379.0520324707031
time:  378.6670227050781
time:  377.1146240234375
time:  378.71923828125
time:  378.2932434082031
time:  378.7079772949219
time:  377.21600341796875
time:  378.22259521484375
time:  378.1888122558594
time:  378.3618469238281
time:  377.6737365722656
time:  378.7253723144531
time:  377.6266174316406
time:  379.9859313964844
time:  379.1380615234375
time:  377.7362060546875
time:  405.8890380859375
time:  377.34808349609375
time:  378.1744689941406
time:  378.96295166015625
time:  377.1955261230469
time:  378.9639587402344
time:  377.6419982910156
time:  378.1652526855469
time:  378.9240417480469
time:  377.31121826171875
time:  376.9774169921875
time:  378.15399169921875
time:  376.4090881347656
time:  378.0997009277344
time:  377.2139587402344
time:  378.3034973144531
time:  377.0204162597656
time:  376.8913879394531
time:  377.4658508300781
time:  377.1177062988281
time:  377.5436706542969
time:  377.0040283203125
time:  377.96966552734375
time:  377.238525390625
time:  376.7879638671875
time:  377.5252380371094
time:  376.59954833984375
time:  377.7976379394531
time:  378.57281494140625
time:  377.2467346191406
time:  376.14385986328125
time:  377.51910400390625
time:  376.8371276855469
time:  376.9098205566406
time:  376.9016418457031
time:  376.3179626464844
time:  377.7054748535156
time:  376.66302490234375
time:  375.5622253417969
time:  377.6030578613281
time:  375.7864990234375
time:  376.4009094238281
time:  377.34912109375
time:  376.4039611816406
time:  375.7864990234375
time:  376.70196533203125
time:  376.047607421875
time:  376.521728515625
time:  376.6456298828125
time:  375.62060546875
time:  376.16229248046875
time:  376.7091064453125
time:  376.3363952636719
time:  375.5735168457031
time:  376.4264831542969
time:  376.5688171386719
time:  375.15673828125
time:  376.9917297363281
time:  376.7357482910156
time:  375.4598388671875
time:  376.9702453613281
time:  376.6609802246094
time:  375.2048645019531
time:  375.6103820800781
time:  377.26104736328125
time:  375.0953063964844
time:  375.0267028808594
time:  376.7582702636719
time:  375.4229736328125
time:  374.59661865234375
time:  376.2749328613281
time:  375.762939453125
time:  375.79058837890625
time:  376.2155456542969
time:  376.1162109375
time:  376.13055419921875
time:  375.478271484375
time:  375.5130920410156
time:  376.8309631347656
time:  375.9237060546875
time:  375.3144226074219
time:  376.4193420410156
time:  375.8888854980469
time:  375.5489196777344
time:  376.2391052246094
time:  375.9493103027344
time:  375.1853942871094
time:  376.0506896972656
time:  376.2821044921875
time:  375.7608947753906
time:  375.2652893066406
time:  376.64971923828125
time:  375.947265625
time:  375.51617431640625
time:  376.1141662597656
time:  375.9892578125
time:  376.1080322265625
time:  376.1346435546875
time:  375.7107238769531
time:  374.9888000488281
time:  374.7624816894531
time:  375.6390380859375
time:  375.6267395019531
time:  376.5002136230469
time:  375.11883544921875
time:  375.5776062011719
time:  376.3179626464844
time:  374.9652404785156
time:  375.06561279296875
time:  375.8294982910156
time:  375.32568359375
time:  376.3312683105469
time:  375.8755798339844
time:  375.3154602050781
time:  376.5667724609375
time:  375.5970458984375
time:  374.63348388671875
time:  376.5370788574219
time:  375.45062255859375
time:  374.8730773925781
time:  376.1571960449219
time:  375.6093444824219
time:  374.9273681640625
time:  375.67694091796875
time:  375.9554443359375
time:  376.7767028808594
time:  376.3271789550781
time:  377.4617614746094
time:  375.2785949707031
time:  375.0625305175781
time:  376.9374694824219
time:  376.45208740234375
time:  375.17926025390625
time:  376.3988342285156
time:  375.910400390625
time:  375.6871643066406
time:  375.0953063964844
time:  376.07525634765625
time:  375.2437744140625
time:  375.75372314453125
time:  375.647216796875
time:  376.27801513671875
time:  376.3056640625
time:  375.7742004394531
time:  376.28826904296875
time:  376.0312194824219
time:  375.1116943359375
time:  376.8985595703125
time:  376.6384582519531
time:  375.1137390136719
time:  377.2190856933594
time:  376.34356689453125
time:  375.3594970703125
time:  377.1801452636719
time:  375.8520202636719
time:  375.2366027832031
time:  415.67742919921875
time:  375.5540466308594
time:  376.38348388671875
time:  377.32965087890625
time:  374.7369079589844
time:  377.965576171875
time:  376.5780334472656
time:  375.84075927734375
time:  377.32965087890625
time:  375.6871643066406
time:  376.732666015625
time:  377.0163269042969
time:  375.6083068847656
time:  377.59283447265625
time:  375.7568054199219
time:  375.468017578125
time:  378.060791015625
time:  375.4833984375
time:  375.647216796875
time:  377.5805358886719
time:  375.8991394042969
time:  375.88787841796875
time:  377.5887451171875
time:  375.8888854980469
time:  376.19915771484375
time:  377.13714599609375
time:  375.9267883300781
time:  376.4285583496094
time:  376.9333801269531
time:  375.62164306640625
time:  375.9769592285156
time:  376.98663330078125
time:  376.4633483886719
time:  376.764404296875
time:  377.3470764160156
time:  377.0255432128906
time:  376.1510314941406
time:  376.48486328125
time:  377.56005859375
time:  376.853515625
time:  375.7793273925781
time:  377.1903991699219
time:  376.511474609375
time:  375.9185791015625
time:  377.46380615234375
time:  376.2339782714844
time:  375.6820373535156
time:  377.85906982421875
time:  375.52435302734375
time:  375.8796691894531
time:  377.5283203125
time:  376.2165832519531
time:  376.2073669433594
time:  377.7597351074219
time:  375.49774169921875
time:  376.6456298828125
avg. time:  377.03450772693304
Peak memory requirement: 1.8367 GB
TORCH.CUDA.MEMORY_SUMMARY:  |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 126749 KiB |   1880 MiB |   8262 GiB |   8262 GiB |
|       from large pool | 111309 KiB |   1867 MiB |   8247 GiB |   8247 GiB |
|       from small pool |  15440 KiB |     21 MiB |     14 GiB |     14 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 126749 KiB |   1880 MiB |   8262 GiB |   8262 GiB |
|       from large pool | 111309 KiB |   1867 MiB |   8247 GiB |   8247 GiB |
|       from small pool |  15440 KiB |     21 MiB |     14 GiB |     14 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 125802 KiB |   1879 MiB |   8259 GiB |   8259 GiB |
|       from large pool | 110390 KiB |   1865 MiB |   8245 GiB |   8245 GiB |
|       from small pool |  15412 KiB |     21 MiB |     14 GiB |     14 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   3002 MiB |   3002 MiB |   3002 MiB |      0 B   |
|       from large pool |   2978 MiB |   2978 MiB |   2978 MiB |      0 B   |
|       from small pool |     24 MiB |     24 MiB |     24 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   8419 KiB | 467203 KiB |   2220 GiB |   2220 GiB |
|       from large pool |   5427 KiB | 465367 KiB |   2204 GiB |   2204 GiB |
|       from small pool |   2992 KiB |   8083 KiB |     15 GiB |     15 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     247    |     298    |  237449    |  237202    |
|       from large pool |       5    |      28    |  122042    |  122037    |
|       from small pool |     242    |     293    |  115407    |  115165    |
|---------------------------------------------------------------------------|
| Active allocs         |     247    |     298    |  237449    |  237202    |
|       from large pool |       5    |      28    |  122042    |  122037    |
|       from small pool |     242    |     293    |  115407    |  115165    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      38    |      38    |      38    |       0    |
|       from large pool |      26    |      26    |      26    |       0    |
|       from small pool |      12    |      12    |      12    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      21    |      40    |  146891    |  146870    |
|       from large pool |       2    |      21    |  102486    |  102484    |
|       from small pool |      19    |      24    |   44405    |   44386    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

