Used config:
{'B': 16,
 'B_seq': 16,
 'D': 128,
 'D_inner': 512,
 'D_k': 16,
 'D_v': 16,
 'H': 8,
 'I': 100,
 'M': 100,
 'N': 900,
 'attn_dropout': 0.1,
 'data_dir': 'data/megapixel_mnist/dsets/megapixel_mnist_1500',
 'dropout': 0.1,
 'eager': True,
 'enc_type': 'resnet18',
 'eps': 1e-06,
 'is_image': True,
 'lr': 0.001,
 'n_chan_in': 1,
 'n_class': 10,
 'n_epoch': 150,
 'n_epoch_warmup': 10,
 'n_res_blocks': 2,
 'n_token': 4,
 'n_worker': 8,
 'patch_size': [50, 50],
 'patch_stride': [50, 50],
 'pin_memory': True,
 'pretrained': False,
 'seed': 0,
 'shuffle': True,
 'shuffle_style': 'batch',
 'tasks': {'task0': {'act_fn': 'softmax',
                     'id': 0,
                     'metric': 'accuracy',
                     'name': 'majority'},
           'task1': {'act_fn': 'softmax',
                     'id': 1,
                     'metric': 'accuracy',
                     'name': 'max'},
           'task2': {'act_fn': 'softmax',
                     'id': 2,
                     'metric': 'accuracy',
                     'name': 'top'},
           'task3': {'act_fn': 'sigmoid',
                     'id': 3,
                     'metric': 'multilabel_accuracy',
                     'name': 'multi'}},
 'track_efficiency': True,
 'track_epoch': 0,
 'use_pos': True,
 'wd': 0.1}
/usr/local/lib/python3.10/dist-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at ../aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
/usr/local/lib/python3.10/dist-packages/torch/autograd/graph.py:744: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at ../aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
time:  373.3329772949219
time:  373.7784423828125
time:  376.563720703125
time:  374.53106689453125
time:  374.64166259765625
time:  375.8970947265625
time:  375.330810546875
time:  375.37176513671875
time:  374.69696044921875
time:  375.4403991699219
time:  374.88433837890625
time:  376.0291748046875
time:  375.6175231933594
time:  374.73895263671875
time:  375.1045227050781
time:  375.4526672363281
time:  376.35992431640625
time:  376.08551025390625
time:  376.6384582519531
time:  375.98309326171875
time:  376.21453857421875
time:  376.268798828125
time:  376.1203308105469
time:  376.59033203125
time:  376.9190368652344
time:  376.12750244140625
time:  376.91802978515625
time:  375.7998046875
time:  375.7096862792969
time:  377.4095458984375
time:  376.2503662109375
time:  376.0824279785156
time:  377.11566162109375
time:  377.1914367675781
time:  377.1125793457031
time:  376.27288818359375
time:  376.95489501953125
time:  376.7193603515625
time:  377.33477783203125
time:  377.90411376953125
time:  377.965576171875
time:  376.48382568359375
time:  377.1125793457031
time:  377.7740783691406
time:  378.0546569824219
time:  376.89447021484375
time:  377.7413024902344
time:  377.923583984375
time:  377.6358337402344
time:  377.5252380371094
time:  377.1903991699219
time:  377.9082336425781
time:  378.287109375
time:  377.59796142578125
time:  378.2266845703125
time:  378.6310729980469
time:  377.5672302246094
time:  379.2680969238281
time:  379.0960693359375
time:  378.07513427734375
time:  378.4181823730469
time:  378.3311462402344
time:  378.90252685546875
time:  378.9956970214844
time:  378.355712890625
time:  378.5379943847656
time:  379.0172119140625
time:  379.2507019042969
time:  379.44012451171875
time:  378.029052734375
time:  379.60601806640625
time:  378.7909240722656
time:  380.0709228515625
time:  380.15692138671875
time:  378.8533630371094
time:  378.61688232421875
time:  380.06170654296875
time:  378.82061767578125
time:  380.5368347167969
time:  379.72174072265625
time:  380.2367858886719
time:  379.46881103515625
time:  379.821044921875
time:  379.94189453125
time:  378.76019287109375
time:  379.7391357421875
time:  379.5251159667969
time:  379.7043151855469
time:  380.04327392578125
time:  379.926513671875
time:  380.7016906738281
time:  380.51226806640625
time:  379.41656494140625
time:  380.2695617675781
time:  380.5829162597656
time:  381.4328308105469
time:  381.1481628417969
time:  380.10675048828125
time:  379.6643981933594
time:  380.8450622558594
time:  380.7354736328125
time:  379.620361328125
time:  380.5870056152344
time:  381.1829833984375
time:  381.0099182128906
time:  381.3007507324219
time:  381.6161193847656
time:  380.0995788574219
time:  379.9767150878906
time:  380.6504821777344
time:  381.9100036621094
time:  380.95361328125
time:  379.54559326171875
time:  380.5542297363281
time:  381.1481628417969
time:  381.1164245605469
time:  381.39801025390625
time:  381.2864074707031
time:  380.5542297363281
time:  379.5660705566406
time:  381.36114501953125
time:  380.4958801269531
time:  379.9214172363281
time:  380.8778381347656
time:  381.949951171875
time:  381.1665954589844
time:  380.97100830078125
time:  381.03448486328125
time:  381.0355224609375
time:  379.66949462890625
time:  380.400634765625
time:  379.4790344238281
time:  378.9465637207031
time:  380.0135803222656
time:  380.3135986328125
time:  381.1389465332031
time:  380.3607177734375
time:  379.8681640625
time:  380.1773986816406
time:  379.3816833496094
time:  379.8067321777344
time:  378.9066162109375
time:  379.4073486328125
time:  380.54705810546875
time:  378.57891845703125
time:  379.2640075683594
time:  379.5199890136719
time:  379.1933288574219
time:  379.9203796386719
time:  380.2685546875
time:  378.7959899902344
time:  379.1800231933594
time:  379.4278259277344
time:  378.6588134765625
time:  379.03155517578125
time:  379.0428161621094
time:  378.3004150390625
time:  379.99615478515625
time:  379.3223571777344
time:  377.5027160644531
time:  379.11346435546875
time:  378.6792907714844
time:  378.8687438964844
time:  378.6485900878906
time:  378.2881164550781
time:  379.0694274902344
time:  377.95635986328125
time:  379.1943359375
time:  378.38848876953125
time:  378.17242431640625
time:  379.5630187988281
time:  377.9020690917969
time:  378.1365661621094
time:  377.9891052246094
time:  378.4765319824219
time:  377.7228698730469
time:  378.6895446777344
time:  376.8934326171875
time:  377.82421875
time:  377.4422912597656
time:  377.7372131347656
time:  378.37310791015625
time:  377.90411376953125
time:  377.2590026855469
time:  378.1048278808594
time:  377.4433288574219
time:  378.998779296875
time:  376.8668212890625
time:  377.59796142578125
time:  378.1560363769531
time:  377.9164123535156
time:  376.8586120605469
time:  377.280517578125
time:  377.840576171875
time:  378.0474853515625
time:  376.3947448730469
time:  377.2692565917969
time:  377.9420166015625
time:  378.2615051269531
time:  378.81036376953125
time:  377.41363525390625
time:  377.6102294921875
time:  377.9154052734375
time:  376.458251953125
time:  377.06341552734375
time:  378.29119873046875
time:  377.61126708984375
time:  377.1545715332031
time:  376.658935546875
time:  377.6634826660156
time:  376.7633972167969
time:  377.4341125488281
time:  377.17913818359375
time:  378.0126647949219
time:  377.0050048828125
time:  376.6067199707031
time:  378.0915222167969
time:  376.816650390625
time:  377.175048828125
time:  376.6773681640625
time:  377.49957275390625
time:  377.14227294921875
time:  376.6446228027344
time:  378.05670166015625
time:  378.42431640625
time:  377.4842834472656
time:  377.4064636230469
time:  377.523193359375
time:  377.3798522949219
time:  377.61944580078125
time:  376.9978942871094
time:  376.91290283203125
time:  376.7490539550781
time:  376.84735107421875
time:  377.31121826171875
time:  377.7597351074219
time:  378.0966491699219
time:  377.1125793457031
time:  378.6475524902344
time:  377.3818664550781
time:  377.55596923828125
time:  376.7398376464844
time:  377.26104736328125
time:  376.7029724121094
time:  377.3736877441406
time:  377.0531921386719
time:  378.0229187011719
time:  376.6241149902344
time:  376.8862609863281
time:  377.81707763671875
time:  376.76953125
time:  377.6204833984375
time:  376.88116455078125
time:  378.0730895996094
time:  377.6675720214844
time:  377.1934814453125
time:  377.18426513671875
time:  378.13555908203125
time:  378.13555908203125
time:  378.46630859375
time:  377.44024658203125
time:  377.860107421875
time:  377.4443664550781
time:  377.4658508300781
time:  377.43206787109375
time:  378.30450439453125
time:  376.59747314453125
time:  377.9215393066406
time:  377.5487976074219
time:  377.90618896484375
time:  377.7136535644531
time:  377.12384033203125
time:  377.2119140625
time:  378.3976745605469
time:  376.9753723144531
time:  376.97637939453125
time:  377.9809265136719
time:  377.8938903808594
time:  377.6030578613281
time:  377.1310119628906
time:  377.9031066894531
time:  376.7848815917969
time:  377.8078308105469
time:  377.7648620605469
time:  378.27276611328125
time:  377.61944580078125
time:  377.9297180175781
time:  378.40179443359375
time:  379.694091796875
time:  379.8466491699219
time:  377.4115905761719
time:  379.24658203125
time:  377.4842834472656
time:  378.74993896484375
time:  378.1263427734375
time:  378.6158142089844
time:  377.97479248046875
time:  378.4540100097656
time:  379.26605224609375
time:  377.5836181640625
time:  378.5010681152344
time:  377.9256286621094
time:  379.2783508300781
time:  378.397705078125
time:  378.0915222167969
time:  378.2717590332031
time:  378.71002197265625
time:  378.6014709472656
time:  377.6204833984375
time:  378.57281494140625
time:  378.919921875
avg. time:  378.23944140860505
Peak memory requirement: 1.8367 GB
TORCH.CUDA.MEMORY_SUMMARY:  |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 126749 KiB |   1880 MiB |   8262 GiB |   8262 GiB |
|       from large pool | 111309 KiB |   1867 MiB |   8247 GiB |   8247 GiB |
|       from small pool |  15440 KiB |     21 MiB |     14 GiB |     14 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 126749 KiB |   1880 MiB |   8262 GiB |   8262 GiB |
|       from large pool | 111309 KiB |   1867 MiB |   8247 GiB |   8247 GiB |
|       from small pool |  15440 KiB |     21 MiB |     14 GiB |     14 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 125802 KiB |   1879 MiB |   8259 GiB |   8259 GiB |
|       from large pool | 110390 KiB |   1865 MiB |   8245 GiB |   8245 GiB |
|       from small pool |  15412 KiB |     21 MiB |     14 GiB |     14 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   3002 MiB |   3002 MiB |   3002 MiB |      0 B   |
|       from large pool |   2978 MiB |   2978 MiB |   2978 MiB |      0 B   |
|       from small pool |     24 MiB |     24 MiB |     24 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   8419 KiB | 467203 KiB |   2220 GiB |   2220 GiB |
|       from large pool |   5427 KiB | 465367 KiB |   2204 GiB |   2204 GiB |
|       from small pool |   2992 KiB |   8083 KiB |     15 GiB |     15 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     247    |     298    |  237449    |  237202    |
|       from large pool |       5    |      28    |  122042    |  122037    |
|       from small pool |     242    |     293    |  115407    |  115165    |
|---------------------------------------------------------------------------|
| Active allocs         |     247    |     298    |  237449    |  237202    |
|       from large pool |       5    |      28    |  122042    |  122037    |
|       from small pool |     242    |     293    |  115407    |  115165    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      38    |      38    |      38    |       0    |
|       from large pool |      26    |      26    |      26    |       0    |
|       from small pool |      12    |      12    |      12    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      21    |      40    |  146891    |  146870    |
|       from large pool |       2    |      21    |  102486    |  102484    |
|       from small pool |      19    |      24    |   44405    |   44386    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

